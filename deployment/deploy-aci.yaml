api-version: 2021-03-01
location: switzerlandnorth
name: link-shortener-test-2
properties:
  containers:
    - name: link-shortener
      properties:
        image: jublaost.azurecr.io/node-linkshortener:${{ github.sha }}
        ports:
          - port: 8080
            protocol: TCP
        resources:
          requests:
            cpu: 1
            memoryInGB: 0.5
        environmentVariables:
          - name: APP_ID
            value: ${{ SECRETS.APP_ID }} 
          - name: TENANT_ID
            value: ${{ SECRETS.TENANT_ID }}
          - name: APP_SECRET
            value: ${{ SECRETS.APP_SECRET }}
          - name: SITE_ID
            value: ${{ SECRETS.SITE_ID }}
          - name: LIST_ID
            value: ${{ SECRETS.LIST_ID }}
           
    - name: caddy
      properties:
        image: caddy:latest
        command:
          [
            'caddy',
            'reverse-proxy',
            '--from',
            'link-shortener-jublaost-2.switzerlandnorth.azurecontainer.io',
            '--to',
            'localhost:8080',
          ]
        ports:
          - port: 80
            protocol: TCP
          - port: 443
            protocol: TCP
        resources:
          requests:
            cpu: 0.5
            memoryInGB: 0.5
  ipAddress:
    ports:
      - port: 80
        protocol: TCP
      - port: 443
        protocol: TCP
    type: Public
    dnsNameLabel: link-shortener-jublaost-2
  osType: Linux
tags: null
type: Microsoft.ContainerInstance/containerGroups